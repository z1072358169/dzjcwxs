<!DOCTYPE html>
<html>
<head>
	<title>xiangqing.html</title>
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="this is my page">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link href="/dzjc/css/bootstrap.css" rel="stylesheet" />
	<link rel="stylesheet" href="/dzjc/css/jpgzoom/mag.css" />
	<link rel="stylesheet" href="/dzjc/css/jpgzoom/default.css" />
	<link rel="stylesheet" href="/dzjc/css/jpgzoom/index.css" />
	<script src="/dzjc/js/jquery-1.8.2.min.js" type="text/javascript"></script>
	<script src="/dzjc/js/angular1.5.min.js" type="text/javascript"></script>
	<script src="/dzjc/js/angular-cookie.min.js"></script>
	<script src="/dzjc/js/jpgzoom/jquery.bridget.js"></script>
	<script src="/dzjc/js/jpgzoom/jquery.mousewheel.min.js"></script>
	<script src="/dzjc/js/jpgzoom/PreventGhostClick.js"></script>
	<script src="/dzjc/js/jpgzoom/mag.js"></script>
	<script src="/dzjc/js/jpgzoom/mag-jquery.js"></script>
	<script src="/dzjc/js/jpgzoom/mag-control.js"></script>
	<script type="text/javascript" src="/dzjc/js/layer/layer.js"></script>
</head>
<style>
	.bar-h3-btn{float: right;}
	.mr {
		margin-right: 10px !important;
	}
</style>
<body ng-app="app" ng-controller="xiangqingCtrl">
		<div class="col-md-12 column">
			<div style="width: 600px;height: 400px;float: left">
					<div class="proportion" style="width: 600px;height: 400px;">
						<div mag-thumb="outer">
							<img ng-src="{{prmdata.URL1}}" err-src="img/404.jpg" />
						</div>
						<div class="filler"></div>
					</div>
				<!-- <div style="height: 275px;width: 328px;float: left">
					<div class="proportion" style="width: 328px;height: 275px">
						<div mag-thumb="outerb">
							<img ng-src="{{prmdata.URL2}}" err-src="img/404.jpg" />
						</div>
						<div class="filler"></div>
					</div>
				</div>
				<div style="height: 275px;width: 656px;float: left">
					<div class="proportion" style="width: 656px;height: 275px">
						<div mag-thumb="outer">
							<img ng-src="{{prmdata.URL3}}" err-src="img/404.jpg" />
						</div>
						<div class="filler"></div>
					</div>
					<a ng-href="{{prmdata.evidence_S_P}}" err-src="img/404.jpg" style="width:100%;height:100%;" class="jqzoom" title="kawasaki">
						<img id="photo" ng-src="{{prmdata.evidence_S_P}}" err-src="img/404.jpg" title="kawasakigreen" style="width:100%;height:100%;border: 1px solid #666;" />
					</a>
				</div> -->
			</div>
			<div style="width:950px;position: absolute;left: 615px;">
				<div style="height: 400px; width: 950px">
					<div mag-zoom="outer" class="mag-eg-el" style="float: right;position:relative;overflow:hidden;">
						<img ng-src="{{prmdata.URL1}}" err-src="img/404.jpg" />
					</div>
				</div>
			</div>
			</div>
			<div style="margin: 0;padding:0;">
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="info">
							<th colspan="3">车辆识别信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 33%;">
								<div style="width: 30%;float: left;text-align: right;font-weight: bold;">车牌号码：</div>
								<div style="width: 50%;float:left;background-color: #0030d7;color: #ffffff;font-size: 18px;">
									{{prmdata.HPHM}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">号牌种类：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.pExplain}}
								</div>
							</td>
							<td style="width: 33%;">
							</td>
						</tr>
					</tbody>
				</table>
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="info">
							<th colspan="4">车辆违法信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法时间：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.CJSJ}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法地点：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.CJDZ}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法类型：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.WFDM}}-{{prmdata.illegal_explanation}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">审核状态：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.SFSH}}
								</div>
							</td>
						</tr>
					</tbody>
				</table>
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="info">
							<th colspan="3">机动车信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车辆品牌：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.clpp1}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车辆类型：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikudaH}}
								</div>
							</td>
							<td style="width: 33%;">
								<!-- <div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车主姓名：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.syr}}
								</div> -->
							</td>
						</tr>
						<tr>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车身颜色：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.csys}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">使用性质：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.syxz}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车辆状态：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.zt}}
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<!-- <div class="col-md-12 column form-horizontal" style="margin-top: 10px;">
			<table class="table table-hover">
				<tr class="info">
					<td colspan="3">车辆识别信息</td>
				</tr>
				<tr>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">采集机关：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.CJJGDM}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">号牌种类：</label>
							<div class="col-lg-6 form-controla">
								{{prmdata.HPZL}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">号牌号码：</label>
							<div class="col-lg-6 " style="background-color: #0030d7;height: 40px;color: #ffffff;font-size: 28px;">
								{{prmdata.HPHM}}
							</div>
						</div>
					</td>
				</tr>
				<tr class="info">
					<td colspan="3">车辆违法信息</td>
				</tr>
				<tr>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">违法时间：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.SJSCSJ}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">违法地点：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.CJDZ}}SJSCSJ
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">车速：</label>
							<div class="col-lg-6 form-controla">
								{{prmdata.vehicleSpeed}}km/h
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div> -->
		<div class="col-md-12" style="padding-top: 15px;">
			<div style="width: 400px;float: right;">
				<button type="button" class="btn btn-secondary bar-h3-btn mr" ng-click="off()">关闭</button>
				<button type="button" class="btn btn-primary bar-h3-btn mr" ng-click="DownOne()">下一条</button>
				<button type="button" class="btn btn-primary bar-h3-btn mr" ng-click="UpOne()">上一条</button>
			</div>
		</div>
</body>
</html>
<script>
    var app = angular.module('app', ['ngCookies']);
    app.controller('xiangqingCtrl', function($scope, $http,$cookieStore) {
        $scope.person = $cookieStore.get("person");
        if($scope.person.permissions.qbsj==true){
			$scope.userqbsj = "";
		}else{
			$scope.userqbsj = $scope.person.userName;
		};
    	var wfdd=parent.$("#exampledata1").val();
    	var hphma=parent.$("#hphma").val();
    	var hphm=parent.$("#hphm").val();
    	var hphmb = hphma+hphm;
    	var starttime=parent.$("#starttime").val();
    	var endtime=parent.$("#endtime").val();
    	var wfxw=parent.$("#wfxw").val();
    	var SHSF = parent.$("#tgzt").val();
        var id = GetQueryString("id");
        $scope.lopopup = function(){
			layer.load(1, {
				shade: [0.3, '#393D49']
			});
		};
		$scope.popup1 = function(name){
			layer.closeAll('loading');
			layer.msg(name);
		};
		$scope.liuheyikuHP = function(data1){
			$http({
	            method:'get', //get请求方式
	            url : "http://41.5.253.165:8080/findcllx/getcllx",
	            params:{
	                cllx:data1
	            }
	        }).then(function(response){
	            //成功时执行
	            if(response.data==null||response.data==""){
	            	$scope.liuheyikudaH = "不在本地区";
	            }else{
	            	$scope.liuheyikudaH = response.data[0].mes;
	            }
	        },function(response){
	            $scope.popup1("错误");
	        });
		};
		$scope.liuheyiku = function(data1,data2){
			$http({
	            method : 'get',
	            url : "http://41.5.253.170:8080/LHY/GetMes",
	            params:{
	                cph:data1,
	                hpzl:data2
	            }
	        }).success(function(data) {
	        	$scope.liuheyikuda = data;
	        	$scope.liuheyikuHP(data.cllx);
	        }).error(function() {
	            $scope.popup1("错误");
	        });
		};
        $http({
            method : 'get',
            url : "/dzjc/queryIntervalVM.action",
            params:{
                sysid:id//ID
            }
        }).success(function(data) {
        	var da = data;
        	$scope.liuheyiku(data[0].HPHM,data[0].HPZL);
        	angular.forEach(da, function(data, index) {
                switch(data.SFSH){
                    case '-1':data.SFSH='未审核'; break;
                    case '0':data.SFSH='已通过'; break;
                    case '1':data.SFSH='已作废'; break;
                };
            });
            $scope.prmdata = da[0];
            var $host;
            $host = $('[mag-thumb="outer"]');
            $host.mag({
                mode: 'outer',
                ratio: 2 / 1,
                zoomMin:3
            });
           /*  $http({//车牌种类
                method : 'get',
                url : "/dzjc/queryPlateType.action"
            }).success(function(data) {
               console.log(data);
            }).error(function() {
                alert('无法连接到服务器');
            }); */
        }).error(function() {
            $scope.popup1("错误");
        });
        //下一条
        $scope.DownOne = function(){
        	$scope.lopopup();
        	$scope.prmdata.URL1 = "/dzjc/img/400.jpg";
            $http({
                method : 'get',
                url : "/dzjc/findDownOnewhb.action",
                params:{
                	HPHM:hphmb,
                	CJDZ:wfdd,
                	startTime:starttime,
                	endTime:endtime,
                	WFDM:wfxw,
                	SFSH:SHSF,
                    nowId:$scope.prmdata.sysId,//ID
                    nowTime:$scope.prmdata.CJSJ
                }
            }).success(function(data) {
                if(data[0] == null||data[0] == "null"){
                    $scope.popup1("已经是最后一条了");
				}else{
            		$scope.liuheyiku(data[0].HPHM,data[0].HPZL);
					var da = data;
		        	angular.forEach(da, function(data, index) {
		                switch(data.SFSH){
		                    case '-1':data.SFSH='未审核'; break;
		                    case '0':data.SFSH='已通过'; break;
		                    case '1':data.SFSH='已作废'; break;
		                };
		            });
                    $scope.prmdata = da[0];
				};
				layer.closeAll('loading');
            }).error(function() {
                $scope.popup1("错误");
            });
		};
        //上一条
        $scope.UpOne = function(){
        	$scope.lopopup();
        	$scope.prmdata.URL1 = "/dzjc/img/400.jpg";
            $http({
                method : 'get',
                url : "/dzjc/findUpOnewhb.action",
                params:{
                	HPHM:hphmb,
                	CJDZ:wfdd,
                	startTime:starttime,
                	endTime:endtime,
                	WFDM:wfxw,
                	SFSH:SHSF,
                    nowId:$scope.prmdata.sysId,//ID
                    nowTime:$scope.prmdata.CJSJ
                }
            }).success(function(data) {
                if(data[0] == null||data[0] == "null"){
					$scope.popup1("已经是第一条了");
                }else{
            		$scope.liuheyiku(data[0].HPHM,data[0].HPZL);
                	var da = data;
		        	angular.forEach(da, function(data, index) {
		                switch(data.SFSH){
		                    case '-1':data.SFSH='未审核'; break;
		                    case '0':data.SFSH='已通过'; break;
		                    case '1':data.SFSH='已作废'; break;
		                };
		            });
                    $scope.prmdata = da[0];
                };
                layer.closeAll('loading');
            }).error(function() {
                $scope.popup1("错误");
            });
        };
        $scope.off = function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        };
        function GetQueryString(name)//获取链接参数
        {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null)
                return unescape(r[2]);
            return null;
        };
    });
</script>