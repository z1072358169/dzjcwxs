<!DOCTYPE html>
<html>
<head>
	<title>xiangqing.html</title>
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="this is my page">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link href="../css/bootstrap.css" rel="stylesheet" />
	<link href="../css/imgpig/cloudzoom.css" rel="stylesheet"/>
	<script src="../js/jquery-1.8.2.min.js" type="text/javascript"></script>
	<script src="../js/angular1.5.min.js" type="text/javascript"></script>
	<script src="../js/angular-cookie.min.js"></script>
	<script type="text/javascript" src="../js/imgpig/cloudzoom.js"></script>
	<script type="text/javascript" src="../js/layer/layer.js"></script>
</head>
<style>
	.bar-h3-btn{float: right;}
	.mr {
		margin-right: 10px !important;
	}
</style>
<body ng-app="app" ng-controller="xiangqingCtrl">
		<div class="col-md-12 column">
			<div id="imgzoom" class="cloudzoom-div">
			</div>
			<div style="margin: 0;padding:0;">
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="info">
							<th colspan="3">车辆识别信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 33%;">
								<div style="width: 30%;float: left;text-align: right;font-weight: bold;">车牌号码：</div>
								<div style="width: 50%;float:left;background-color: #0030d7;color: #ffffff;font-size: 18px;">
									{{prmdata.HPHM}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">号牌种类：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.pExplain}}
								</div>
							</td>
							<td style="width: 33%;">
							</td>
						</tr>
					</tbody>
				</table>
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="info">
							<th colspan="4">车辆违法信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法时间：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.CJSJ}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法地点：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.CJDZ}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法类型：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.WFDM}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">审核状态：</div>
								<div style="width: 70%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{prmdata.SFSH}}
								</div>
							</td>
						</tr>
					</tbody>
				</table>
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="info">
							<th colspan="3">机动车信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车辆品牌：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.clpp1}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车辆类型：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.cllx}}
								</div>
							</td>
							<td style="width: 33%;">
								<!-- <div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车主姓名：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.syr}}
								</div> -->
							</td>
						</tr>
						<tr>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车身颜色：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.csys}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">使用性质：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.syxz}}
								</div>
							</td>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">车辆状态：</div>
								<div style="width: 50%;float:left;border:1px solid #000;padding: 1px 2px;">
									{{liuheyikuda.zt}}
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<!-- <div class="col-md-12 column form-horizontal" style="margin-top: 10px;">
			<table class="table table-hover">
				<tr class="info">
					<td colspan="3">车辆识别信息</td>
				</tr>
				<tr>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">采集机关：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.CJJGDM}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">号牌种类：</label>
							<div class="col-lg-6 form-controla">
								{{prmdata.HPZL}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">号牌号码：</label>
							<div class="col-lg-6 " style="background-color: #0030d7;height: 40px;color: #ffffff;font-size: 28px;">
								{{prmdata.HPHM}}
							</div>
						</div>
					</td>
				</tr>
				<tr class="info">
					<td colspan="3">车辆违法信息</td>
				</tr>
				<tr>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">违法时间：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.SJSCSJ}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">违法地点：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.CJDZ}}SJSCSJ
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">车速：</label>
							<div class="col-lg-6 form-controla">
								{{prmdata.vehicleSpeed}}km/h
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div> -->
		<div class="col-md-12" style="padding-top: 15px;">
			<div style="width: 400px;float: right;">
				<button type="button" class="btn btn-secondary bar-h3-btn mr" ng-click="off()">关闭</button>
				<button type="button" class="btn btn-primary bar-h3-btn mr" ng-click="UpDownOne(1)">下一条</button>
				<button type="button" class="btn btn-primary bar-h3-btn mr" ng-click="UpDownOne(-1)">上一条</button>
			</div>
		</div>
</body>
</html>
<script>
    var GserverURL = "/dzjcck/";
    var app = angular.module('app', ['ngCookies']);
    app.controller('xiangqingCtrl', function($scope, $http,$cookieStore) {
        $scope.person = $cookieStore.get("person");
        $scope.prmdata = {};
        $scope.prmdata.URL1 = "/dzjc/img/400.jpg";
        if($scope.person.permissions.qbsj==true){
			$scope.userqbsj = "";
		}else{
			$scope.userqbsj = $scope.person.userName;
		};
        var itemslist = $cookieStore.get("cscxidlist");
        if(itemslist==undefined){
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        }
        var id = GetQueryString("id");
        $scope.lopopup = function(){
			layer.load(1, {
				shade: [0.3, '#393D49']
			});
		};
		$scope.popup1 = function(name){
			layer.closeAll('loading');
			layer.msg(name);
		};
        //判断图片是否存在
        function CheckImgExists(imgurl) {
            var imgurlsrc;
            try {
                if (imgurl.CSMZ=="海康"){
                    imgurlsrc = "http://41.5.252.8:8090/" + imgurl.CJSJ.substr(0,10) + "/" + imgurl.URL1.split("?")[1] + ".jpg";
                    var xmlHttp ;
                    if (window.ActiveXObject){
                        xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                    }else if (window.XMLHttpRequest){
                        xmlHttp = new XMLHttpRequest();
                    }
                    xmlHttp.open("Get",imgurlsrc,false);
                    xmlHttp.send();
                    return (xmlHttp.status==404)?imgurl.URL1:imgurlsrc;
                }else{
                    return imgurl.URL1;
                }
            }catch(err){
                return imgurl.URL1;
            }
        };
//		$scope.liuheyikuHP = function(data1){
//			$http({
//	            method:'get', //get请求方式
//	            url : "http://41.5.253.165:8080/findcllx/getcllx",
//	            params:{
//	                cllx:data1
//	            }
//	        }).then(function(response){
//	            //成功时执行
//	            if(response.data==null||response.data==""){
//	            	$scope.liuheyikudaH = "不在本地区";
//	            }else{
//	            	$scope.liuheyikudaH = response.data[0].mes;
//	            }
//	        },function(response){
//	            $scope.popup1("错误");
//	        });
//		};
		$scope.liuheyiku = function(data1,data2){
			$http({
	            method : 'get',
	            url : "http://41.5.252.45:8081/GetMes",
	            params:{
                    cph:data1,
                    hpzl:data2
	            }
	        }).success(function(data) {
	        	$scope.liuheyikuda = data;
	        	//$scope.liuheyikuHP(data.cllx);
	        }).error(function() {
	            $scope.popup1("错误");
	        });
		};
        $http({
            method : 'get',
            url : GserverURL + "findWfcsold.action",
            params:{
                sysid:id//ID
            }
        }).success(function(data) {
        	var da = data;
            var imgurlsrc = CheckImgExists(data[0]);
            console.log(imgurlsrc);
            $("#imgzoom").empty();
            var imgzom = "<img class = \"cloudzoom\" src=\""+imgurlsrc+"\" style=\"width: 600px;height: 400px;\" data-cloudzoom = \"tintOpacity:0,zoomFlyOut:false,zoomSizeMode:'zoom',startMagnification:5,maxMagnification:8\" />";
            $("#imgzoom").prepend(imgzom);
        	$scope.liuheyiku(data[0].HPHM,data[0].HPZL);
        	angular.forEach(da, function(data, index) {
                switch(data.SFSH){
                    case '-1':data.SFSH='未审核'; break;
                    case '0':data.SFSH='已通过'; break;
                    case '1':data.SFSH='已作废'; break;
                };
            });
            $scope.prmdata = da[0];
            CloudZoom.quickStart();
        }).error(function() {
            $scope.popup1("错误");
        });
        //上一条下一跳
        $scope.UpDownOne = function(a){
            $scope.lopopup();
            var b = itemslist.indexOf($scope.prmdata.sysid);//位置
            if(b==-1){
                $scope.popup1("数据错误");
            }else if(a==-1&&b==0){
                $scope.popup1("已经是第一条了");
                $scope.idchaxunwfxx($scope.prmdata.sysid);
            }else if(a==1&&b==itemslist.length-1){
                $scope.popup1("已经是最后一条了");
                $scope.idchaxunwfxx($scope.prmdata.sysid);
            }else{
                var c = itemslist[b+a];
                $scope.idchaxunwfxx(c);
            }
        };
        $scope.idchaxunwfxx = function (c) {
            $scope.prmdata.URL1 = "/dzjc/img/400.jpg";
            $http({
                method : 'get',
                url : GserverURL + "findWfcsold.action",
                params:{
                    sysid:c
                }
            }).success(function(data) {
                layer.closeAll('loading');
                if(data[0] == null||data[0] == "null"){
                    $scope.popup1("已经是第一条了");
                }else{
                    var imgurlsrc = CheckImgExists(data[0]);
                    $("#imgzoom").empty();
                    var imgzom = "<img class = \"cloudzoom\" src=\""+imgurlsrc+"\" style=\"width: 600px;height: 400px;\" data-cloudzoom = \"tintOpacity:0,zoomFlyOut:false,zoomSizeMode:'zoom',startMagnification:5,maxMagnification:8\" />";
                    if($(".cloudzoom-lens").length > 0) {
                        $(".cloudzoom-lens").children("img").attr('src', imgurlsrc)
                    }
                    if($(".cloudzoom-zoom").length > 0) {
                        $(".cloudzoom-zoom").children("img").attr('src', imgurlsrc)
                    }
                    $("#imgzoom").prepend(imgzom);
                    $scope.liuheyiku(data[0].HPHM,data[0].HPZL);
                    var da = data;
                    angular.forEach(da, function(data, index) {
                        switch(data.SFSH){
                            case '-1':data.SFSH='未审核'; break;
                            case '0':data.SFSH='已通过'; break;
                            case '1':data.SFSH='已作废'; break;
                        };
                    });
                    $scope.prmdata = da[0];
                    CloudZoom.quickStart();
                };
            }).error(function() {
                layer.closeAll('loading');console.log("错误");
            });
        }
        $scope.off = function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        };
        function GetQueryString(name)//获取链接参数
        {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null)
                return unescape(r[2]);
            return null;
        };
    });
</script>