<!DOCTYPE html>
<html>
<head>
	<title>xiangqing.html</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link href="../css/bootstrap.css" rel="stylesheet" />
	<link rel="stylesheet" href="../css/imgpig/cloudzoom.css" />
	<script src="../js/jquery-1.8.2.min.js" type="text/javascript"></script>
	<script src="../js/angular1.5.min.js" type="text/javascript"></script>
	<script src="../js/angular-cookie.min.js"></script>
	<script type="text/javascript" src="../js/imgpig/cloudzoom.js"></script>
	<script type="text/javascript" src="../js/layer/layer.js"></script>
</head>
<style>
	.bar-h3-btn{float: right;}
	.mr {
		margin-right: 10px !important;
	}
</style>
<body ng-app="app" ng-controller="xiangqingCtrl">
		<div class="col-md-12 column">
			<div id="imgzoom" class="cloudzoom-div" onclick="angular.element(this).scope().pigphoto()">
			</div>
			<div style="margin: 0;padding:0;">
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="infohs">
							<th colspan="4">车辆识别信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 33%;">
								<div style="width: 30%;font-weight: bold;  float: left;text-align: right;">号牌种类：</div>
								<div style="width: 50%;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{prmdata.pExplain}}
								</div>
							</td>
							<td style="width: 15%;">
							</td>
							<td style="width: 33%;">
								<div style="width: 25%;float: left;text-align: right;font-weight: bold;line-height: 35px;">车牌号码：</div>
								<div style="width: 40%;float:left;color: #ffffff;font-size: 24px;font-weight: 700;background-color: {{HPhmys}};">
									{{prmdata.HPHM}}
								</div>
							</td>
							<td style="width: 18%;">
							</td>
						</tr>
					</tbody>
				</table>
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="infohs">
							<th>机动车信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 100%;">
								<div style="width: 100px;font-weight: bold;  float: left;text-align: right;">车辆品牌：</div>
								<div style="width: 210px;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;background-color: #0030d7;color: #ffffff;">
									{{liuheyikuda.clpp1}}
								</div>
								<div style="width: 100px;font-weight: bold;  float: left;text-align: right;">车辆类型：</div>
								<div style="width: 210px;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{liuheyikuda.cllx}}
								</div>
								<div style="width: 100px;font-weight: bold;  float: left;text-align: right;">车主姓名：</div>
								<div style="width: 280px;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{liuheyikuda.syr}}
								</div>
							</td>
						</tr>
						<tr>
							<td style="width: 100%;">
								<div style="width: 100px;font-weight: bold;  float: left;text-align: right;">车身颜色：</div>
								<div style="width: 210px;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;background-color: #0030d7;color: #ffffff;">
									{{liuheyikuda.csys}}
								</div>
								<div style="width: 100px;font-weight: bold;  float: left;text-align: right;">使用性质：</div>
								<div style="width: 210px;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{liuheyikuda.syxz}}
								</div>
								<div style="width: 100px;font-weight: bold;  float: left;text-align: right;">车辆状态：</div>
								<div style="width: 280px;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{liuheyikuda.zt}}
								</div>
							</td>
						</tr>
					</tbody>
				</table>
				<table style="width: 100%;margin: 0;" class="table table-condensed">
					<thead>
						<tr class="infohs">
							<th colspan="4">车辆违法信息</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法时间：</div>
								<div style="width: 70%;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{prmdata.CJSJ}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法地点：</div>
								<div style="width: 70%;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{prmdata.CJDZ}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">违法代码：</div>
								<div style="width: 70%;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{prmdata.WFDM}}
								</div>
							</td>
							<td style="width: 25%;">
								<div style="width: 25%;font-weight: bold;  float: left;text-align: right;">审核状态：</div>
								<div style="width: 70%;float:left;border:1px solid #D0D0D0;padding: 1px 2px;font-weight: 600;">
									{{prmdata.MJSCZT}}
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<!-- <div class="col-md-12 column form-horizontal" style="margin-top: 10px;">
			<table class="table table-hover">
				<tr class="info">
					<td colspan="3">车辆识别信息</td>
				</tr>
				<tr>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">采集机关：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.CJJGDM}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">号牌种类：</label>
							<div class="col-lg-6 form-controla">
								{{prmdata.HPZL}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">号牌号码：</label>
							<div class="col-lg-6 " style="background-color: #0030d7;height: 40px;color: #ffffff;font-size: 28px;">
								{{prmdata.HPHM}}
							</div>
						</div>
					</td>
				</tr>
				<tr class="info">
					<td colspan="3">车辆违法信息</td>
				</tr>
				<tr>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">违法时间：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.SJSCSJ}}
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">违法地点：</label>
							<div class="col-lg-7 form-controla">
								{{prmdata.CJDZ}}SJSCSJ
							</div>
						</div>
					</td>
					<td style="width: 33%">
						<div class="form-group">
							<label class="col-lg-4 control-label">车速：</label>
							<div class="col-lg-6 form-controla">
								{{prmdata.vehicleSpeed}}km/h
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div> -->
		<div class="col-md-12" style="padding-top: 15px;">
			<div style="width: 400px;float: right;">
				<button type="button" class="btn btn-secondary bar-h3-btn mr" ng-click="off()">关闭</button>
				<button type="button" class="btn btn-primary bar-h3-btn mr" ng-click="ok()">通过</button>
				<button type="button" class="btn btn-primary bar-h3-btn mr" ng-click="UpDownOne(1)">下一条</button>
				<button type="button" class="btn btn-primary bar-h3-btn mr" ng-click="UpDownOne(-1)">上一条</button>
				<button type="button" class="btn btn-danger bar-h3-btn mr" ng-click="remove()">作废</button>
			</div>
		</div>
</body>
</html>
<script>
    var GserverURL = "/dzjcck/";
    var app = angular.module('app', ['ngCookies']);
    app.controller('xiangqingCtrl', function($scope, $http,$cookieStore) {
        $scope.person = $cookieStore.get("person");
        $scope.prmdata = {};
        $scope.prmdata.URL1 = "/dzjc/img/400.jpg";
        $scope.njzt = false;
        if($scope.person.permissions.qbsj==true){
			$scope.userqbsj = "";
		}else{
			$scope.userqbsj = $scope.person.userName;
		};
        var itemslist = $cookieStore.get("fhcxidlist");
        if(itemslist==undefined){
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        }
        var id = GetQueryString("id");
        $scope.lopopup = function(){
			layer.load(1, {
				shade: [0.3, '#393D49']
			});
		};
		$scope.popup1 = function(name){
			layer.closeAll('loading');
			layer.msg(name);
		};
        //判断图片是否存在
        function CheckImgExists(imgurl) {
            var imgurlsrc;
            try {
                if (imgurl.CSMZ=="海康"){
                    imgurlsrc = "http://41.5.252.8:8090/" + imgurl.CJSJ.substr(0,10) + "/" + imgurl.URL1.split("?")[1] + ".jpg";
                    var xmlHttp ;
                    if (window.ActiveXObject){
                        xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                    }else if (window.XMLHttpRequest){
                        xmlHttp = new XMLHttpRequest();
                    }
                    xmlHttp.open("Get",imgurlsrc,false);
                    xmlHttp.send();
                    return (xmlHttp.status==404)?imgurl.URL1:imgurlsrc;
                }else{
                    return imgurl.URL1;
                }
            }catch(err){
                return imgurl.URL1;
            }
        };
//		$scope.liuheyikuHP = function(data1){
//			$http({
//	            method:'get', //get请求方式
//	            url : "http://41.5.253.165:8080/findcllx/getcllx",
//	            params:{
//	                cllx:data1
//	            }
//	        }).then(function(response){
//	            //成功时执行
//	            if(response.data==null||response.data==""){
//	            	$scope.liuheyikudaH = "不在本地区";
//	            }else{
//	            	$scope.liuheyikudaH = response.data[0].mes;
//	            }
//	        },function(response){
//	            $scope.popup1("错误");
//	        });
//		};
		$scope.liuheyiku = function(data1,data2){
			var cph=data1;
			if(data1.substr(data1.length-1,1)=="学"||data1.substr(data1.length-1,1)=="挂"){
				cph = data1.substr(0,data1.length-1)
			}
			$http({
	            method : 'get',
	            url : "http://41.5.252.45:8081/GetMes",
	            params:{
	                cph:cph,
	                hpzl:data2
	            }
	        }).success(function(data) {
	        	$scope.liuheyikuda = data;
	        	if(data.cllx=="空"){
	        		//$scope.liuheyikudaH = "空";
                    $scope.cxweizi = "车管库中不存在该车信息！";
	        	}else{
                    $scope.cxweizi = "";
	        		//$scope.liuheyikuHP(data.cllx);
	        	}
	        }).error(function() {
	            $scope.popup1("错误");
	        });
		};
		$scope.queryIntervalVMc = function(dataid){
            $scope.lopopup();
			$http({
	            method : 'get',
	            //url : "/dzjc/queryIntervalVM.action",
                url : GserverURL + "queryWffh.action",
	            params:{
	                sysid:dataid//ID
	            }
	        }).success(function(data) {
                layer.closeAll('loading');
	        	var da = data;
                //var imgurlsrc = CheckImgExists(data[0]);
                var imgurlsrc = data[0].URL1;
                $("#imgzoom").empty();
                var imgzom = "<img class = \"cloudzoom\" src=\""+imgurlsrc+"\" style=\"width: 600px;height: 400px;\" data-cloudzoom = \"tintOpacity:0,zoomFlyOut:false,zoomSizeMode:'zoom',startMagnification:5,maxMagnification:8\" />";
                if($(".cloudzoom-lens").length > 0) {
                    $(".cloudzoom-lens").children("img").attr('src', imgurlsrc)
                }
                if($(".cloudzoom-zoom").length > 0) {
                    $(".cloudzoom-zoom").children("img").attr('src', imgurlsrc)
                }
                $("#imgzoom").prepend(imgzom);
	        	$scope.liuheyiku(data[0].HPHM,data[0].HPZL);
	        	angular.forEach(da, function(data, index) {
			                switch(data.MJSCZT){
			                    case 1:$scope.njzt = true;data.MJSCZT='未审核'; break;
			                    case 2:$scope.njzt = false;data.MJSCZT='已通过'; break;
			                    case 3:$scope.njzt = false;data.MJSCZT='已作废'; break;
			                };
	            });
	            $scope.prmdata = da[0];
	            if($scope.prmdata.HPZL=="01"){
				      $scope.HPhmys = "#d7be00";
				}else if($scope.prmdata.HPZL=="52"||$scope.prmdata.HPZL=="51"){
				      $scope.HPhmys = "#06cb34";
				}else{
				      $scope.HPhmys = "#0030D7";
				};
                CloudZoom.quickStart();
	           /*  $http({//车牌种类
	                method : 'get',
	                url : "/dzjc/queryPlateType.action"
	            }).success(function(data) {
	               console.log(data);
	            }).error(function() {
	                alert('无法连接到服务器');
	            }); */
	        }).error(function() {
	            $scope.popup1("错误");
	        });
		};
		$scope.queryIntervalVMc(id);
        //上一条下一跳
        $scope.UpDownOne = function(a){
            $scope.lopopup();
            var b = itemslist.indexOf($scope.prmdata.sysid);//位置
            if(b==-1){
                $scope.popup1("数据错误");
            }else if(a==-1&&b==0){
                $scope.popup1("已经是第一条了");
                $scope.queryIntervalVMc($scope.prmdata.sysid);
            }else if(a==1&&b==itemslist.length-1){
                $scope.popup1("已经是最后一条了");
                $scope.queryIntervalVMc($scope.prmdata.sysid);
            }else{
                var c = itemslist[b+a];
                $scope.queryIntervalVMc(c);
            }
        };
        //作废
        $scope.remove = function() {
        		$scope.lopopup();
	            $http({
	                method : 'get',
	                ///url : "/dzjc/updatews.action",
                    url : "/dzjc/updatewsnew.action",
	                params:{
	                    sysid:$scope.prmdata.sysid,
	                    HPHM:$scope.prmdata.HPHM,
                		mjuserName : $scope.person.userName,
	                    MJSCZT:3
	                }
	            }).success(function(data) {
	            	if(data=="成功"){
	            		$scope.popup1("作废"+data);
	            	}else{
	            		$scope.popup1(data);
	            	}
	                $scope.queryIntervalVMc($scope.prmdata.sysid);
	                //$scope.DownOne();
	                //$scope.DownOne();
	            }).error(function() {
	                $scope.popup1('无法连接到服务器');
	        	});
        };
        //通过
        $scope.ok = function() {
        		$scope.lopopup();
		        $http({
	                method : 'get',
	                //url : "/dzjc/updatews.action",
                    url : "/dzjc/updatewsnew.action",
	                params:{
	                    sysid:$scope.prmdata.sysid,
	                    HPHM:$scope.prmdata.HPHM,
                		mjuserName : $scope.person.userName,
	                    MJSCZT:2
	                }
	            }).success(function(data) {
	            	if(data=="成功"){
	            		$scope.popup1("通过"+data);
	            	}else{
	            		$scope.popup1(data);
	            	}
	                $scope.queryIntervalVMc($scope.prmdata.sysid);
	                //$scope.DownOne();
	                //$scope.DownOne();
	            }).error(function() {
	                $scope.popup1('无法连接到服务器');
	            });
        };
        $scope.off = function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        };
        function GetQueryString(name)//获取链接参数
        {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null)
                return unescape(r[2]);
            return null;
        };
        //双击放大图片
	    $scope.pigphoto = function(){
	    	window.open("/dzjc/tpl/pigphoto.html?" + $scope.prmdata.URL1,"_blank");
	    };
    });
</script>